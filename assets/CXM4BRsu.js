var lt=Object.defineProperty;var ut=(e,t,i)=>t in e?lt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var z=(e,t,i)=>ut(e,typeof t!="symbol"?t+"":t,i);import{v as dt,x as ht,r as _,y as P,z as gt,A as S,o as C,c as R,a as h,F as N,q as W,p as ft,t as j,B as J,C as X,d as G,b as V,w as Y,D as A,n as pt,_ as K}from"./DCAC9Cwb.js";class vt{constructor(){z(this,"history",[]);z(this,"step",-1);this.push([])}get canUndo(){return this.step>0}get canRedo(){return this.step<this.history.length-1}get currentState(){return this.step===-1?[]:this.history[this.step].map(t=>{const i={...t};return t.image&&(i.image=t.image),t.imageData&&(i.imageData=t.imageData),i})}push(t){this.step++,this.history.length=this.step+1,this.history[this.step]=t.map(i=>{const l={...i};return i.image&&(l.image=i.image),i.imageData&&(l.imageData=i.imageData),l})}undo(){return this.canUndo?(this.step--,this.currentState):this.currentState}redo(){return this.canRedo?(this.step++,this.currentState):this.currentState}clear(){this.push([])}}const mt=()=>new vt,wt=(e,t,i)=>{const[l,r]=e,[g,u]=t,[s,w]=i,k=Math.abs((w-u)*l-(s-g)*r+s*u-w*g),p=Math.sqrt(Math.pow(w-u,2)+Math.pow(s-g,2));return k/p},F=(e,t)=>{if(e.length<4)return e;let i=0,l=0;const r=[e[0],e[1]],g=[e[e.length-2],e[e.length-1]];for(let u=2;u<e.length-2;u+=2){const s=wt([e[u],e[u+1]],r,g);s>i&&(i=s,l=u)}if(i>t){const u=F(e.slice(0,l+2),t),s=F(e.slice(l,e.length),t);return u.slice(0,-2).concat(s)}return[...r,...g]},yt=(e,t=1)=>F(e,t),$=80,_t=(e,t)=>Math.abs(e[0]-t[0])<=$&&Math.abs(e[1]-t[1])<=$&&Math.abs(e[2]-t[2])<=$&&Math.abs(e[3]-t[3])<=$,xt=(e,t,i,l)=>{const r=e.data,g=e.width,u=e.height,s=(i*g+t)*4,w=new Uint8ClampedArray([r[s],r[s+1],r[s+2],r[s+3]]),k=new Set,p=[{x:t,y:i}];for(;p.length>0;){const d=p.pop(),U=`${d.x},${d.y}`;if(k.has(U))continue;const v=(d.y*g+d.x)*4,L=new Uint8ClampedArray([r[v],r[v+1],r[v+2],r[v+3]]);if(!_t(L,w))continue;r[v]=l.r,r[v+1]=l.g,r[v+2]=l.b,r[v+3]=l.a*255,k.add(U);const H=[{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}];for(const I of H){const D=d.x+I.x,M=d.y+I.y;D>=0&&D<g&&M>=0&&M<u&&!k.has(`${D},${M}`)&&p.push({x:D,y:M})}}return e},Ct={class:"drawing-board"},kt={class:"tools"},Dt=["onClick"],Mt={class:"brush-size"},bt=["disabled"],It={class:"size-display"},Rt={class:"file-input"},Ut=3,Lt=dt({__name:"DrawingBoard",setup(e){const t=ht({width:800,height:600}),i=[{name:"brush",icon:"🖌️"},{name:"eraser",icon:"⌫"},{name:"magicwand",icon:"✨"}],l=_("brush"),r=_("#000000"),g=_(5),u=_(!1),s=_([]),w=_(null),k=_(null),p=_(null),d=mt();P(()=>d.canUndo),P(()=>d.canRedo);const U=(n,o)=>Math.sqrt(Math.pow(o.x-n.x,2)+Math.pow(o.y-n.y,2)),v=_(null),L=_({image:null,width:0,height:0,x:0,y:0}),H=n=>{l.value=n},I=()=>{console.log("Updating history:",s.value),d.push([...s.value]),console.log("Current history state:",d.currentState),console.log("Can undo:",d.canUndo),console.log("Can redo:",d.canRedo)},D=async n=>{const o=n.target.getStage(),c=o.getPointerPosition();if(l.value==="magicwand"){const y=o.toDataURL(),x=new Image;x.src=y,await new Promise(E=>{x.onload=E});const a=document.createElement("canvas");a.width=o.width(),a.height=o.height();const m=a.getContext("2d");if(!m)return;m.drawImage(x,0,0);const b=m.getImageData(0,0,a.width,a.height),T=r.value,ot=parseInt(T.slice(1,3),16),it=parseInt(T.slice(3,5),16),rt=parseInt(T.slice(5,7),16),q=xt(b,Math.round(c.x),Math.round(c.y),{r:ot,g:it,b:rt,a:1});m.putImageData(q,0,0);const B=new Image;B.src=a.toDataURL(),await new Promise(E=>{B.onload=E});const ct={id:Date.now(),points:[0,0,o.width(),o.height()],image:B,type:"magicwand",imageData:q};s.value=[...s.value,ct],I();return}u.value=!0,p.value=c;const f={id:Date.now(),points:[c.x,c.y],color:l.value==="eraser"?"#ffffff":r.value,width:l.value==="eraser"?20:g.value,type:"line"};s.value=[...s.value,f]},M=n=>{if(!u.value)return;const c=n.target.getStage().getPointerPosition();if(p.value&&U(p.value,c)<Ut)return;const f=s.value[s.value.length-1],y=[...f.points,c.x,c.y];s.value=[...s.value.slice(0,-1),{...f,points:y}],p.value=c},O=()=>{if(!u.value)return;u.value=!1,p.value=null;const n=s.value[s.value.length-1];if(n&&n.points.length>4){const o=yt(n.points);s.value=[...s.value.slice(0,-1),{...n,points:o}]}I()},Q=()=>{const n=d.undo();s.value=n},Z=()=>{const n=d.redo();s.value=n},tt=()=>{s.value=[],d.clear()},et=n=>{const o=w.value.$el.parentElement,c=o.offsetWidth,f=o.offsetHeight,y=n.width/n.height,x=c/f;let a=1,m=0,b=0;y>x?(a=c/n.width,b=(f-n.height*a)/2):(a=f/n.height,m=(c-n.width*a)/2),L.value={image:n,width:n.width*a,height:n.height*a,x:m,y:b}},nt=async n=>{var y;const o=n.target;if(!((y=o.files)!=null&&y.length))return;const c=o.files[0],f=new FileReader;f.onload=async x=>{var m;const a=new Image;a.src=(m=x.target)==null?void 0:m.result,await new Promise(b=>{a.onload=()=>{v.value=a,et(a),b(!0)}})},f.readAsDataURL(c)},at=P(()=>s.value.filter(n=>n.type==="magicwand")),st=P(()=>s.value.filter(n=>n.type==="line"));return gt(()=>{const n=()=>{var c;if(!((c=w.value)!=null&&c.$el))return;const o=w.value.$el.parentElement;o&&(t.width=o.offsetWidth,t.height=o.offsetHeight)};n(),window.addEventListener("resize",n)}),(n,o)=>{const c=S("v-image"),f=S("v-line"),y=S("v-layer"),x=S("v-stage");return C(),R("div",Ct,[h("div",kt,[(C(),R(N,null,W(i,a=>h("button",{key:a.name,class:ft({active:l.value===a.name}),onClick:m=>H(a.name)},j(a.icon),11,Dt)),64)),h("div",Mt,[J(h("input",{type:"range","onUpdate:modelValue":o[0]||(o[0]=a=>g.value=a),min:"1",max:"50",disabled:l.value==="eraser"},null,8,bt),[[X,g.value]]),h("span",It,j(g.value)+"px",1)]),J(h("input",{type:"color","onUpdate:modelValue":o[1]||(o[1]=a=>r.value=a)},null,512),[[X,r.value]]),h("label",Rt,[o[2]||(o[2]=G(" 🖼️ ")),h("input",{type:"file",accept:"image/*",onChange:nt,style:{display:"none"}},null,32)]),h("button",{onClick:Q},"↩️"),h("button",{onClick:Z},"↪️"),h("button",{onClick:tt},"🗑️")]),V(x,{ref_key:"stageRef",ref:w,config:t,onMousedown:D,onMousemove:M,onMouseup:O,onTouchstart:D,onTouchmove:M,onTouchend:O},{default:Y(()=>[V(y,{ref_key:"layerRef",ref:k},{default:Y(()=>[v.value?(C(),A(c,{key:0,config:L.value},null,8,["config"])):pt("",!0),(C(!0),R(N,null,W(at.value,a=>(C(),A(c,{key:a.id,config:{image:a.image,x:0,y:0,width:t.width,height:t.height,opacity:.5}},null,8,["config"]))),128)),(C(!0),R(N,null,W(st.value,a=>(C(),A(f,{key:a.id,config:{points:a.points,stroke:a.color,strokeWidth:a.width,tension:.5,lineCap:"round",lineJoin:"round",opacity:.5}},null,8,["config"]))),128))]),_:1},512)]),_:1},8,["config"])])}}}),Pt=K(Lt,[["__scopeId","data-v-3511cab6"]]),St={},$t={class:"drawing-page"},Ht={class:"drawing-container"};function Tt(e,t){const i=Pt;return C(),R("div",$t,[t[0]||(t[0]=h("h1",null,[h("span",{class:"star left"},"🌟"),G(" 귀여운 그림판 "),h("span",{class:"star right"},"🌟")],-1)),h("div",Ht,[V(i)]),t[1]||(t[1]=h("div",{class:"kawaii-footer"}," ₍ᐢ. ̫ .ᐢ₎ ",-1))])}const zt=K(St,[["render",Tt],["__scopeId","data-v-6762f374"]]);export{zt as default};
